---
title: "Group_Project"
output:
  pdf_document: default
  html_document: default
editor_options: 
  chunk_output_type: console
---
Set Up
```{r}
library(tidyverse)
library(ggplot2)
library(here)
```


Asthma Data Exploration 
```{r}
# Load the Asthma dataset
asthma_ca <- read_csv("lifetime-asthma-prevalence-by-county-2015_2022.csv")
# Replace the incorrect character
asthma_ca$YEARS <- iconv(asthma_ca$YEARS, from = "latin1", to = "UTF-8")
asthma_ca$YEARS <- gsub("[^0-9-]", "-", asthma_ca$YEARS)

# filter for all ages
asthma_ca_all_ages <- asthma_ca %>% 
  filter(`AGE GROUP` == "All ages")

# filter for 2015-2016
asthma_2015_2016 <- asthma_ca_all_ages %>% 
  filter(YEARS == "2015-2016")

# filter for 2021-2022
asthma_2021_2022 <- asthma_ca_all_ages %>% 
  filter(YEARS == "2021-2022")
```

Pollutant data pull
```{r}
pm25_ca<-read_csv("pm25_CA_22.csv")
ozone_ca<-read_csv("ozone_ca.csv")
no2_ca<-read_csv("no2_ca.csv")
so2_ca<-read_csv("so2_ca.csv")
pm10_ca<-read_csv("pm10_ca.csv")

View(pm25_ca)
view(no2_ca)
view(ozone_ca)
view(asthma_2021_2022)
```

assessing county uniformity and reducing county data to only counties for which we have complete data
```{r}
unique(pm25_ca$County)
unique(ozone_ca$County)
#unique(no2_ca$County)
#unique(so2_ca$County)
unique(pm10_ca$County)
unique(asthma_2015_2016$COUNTY)


common_counties <- Reduce(intersect, list(unique(pm25_ca$County),
                                          unique(ozone_ca$County),
                                          unique(pm10_ca$County),
                                          unique(asthma_2015_2016$COUNTY)))

# Trim each dataset to only include rows with counties with complete data
pm25_ca <- pm25_ca[pm25_ca$County %in% common_counties, ]
ozone_ca <- ozone_ca[ozone_ca$County %in% common_counties, ]
pm10_ca <- pm10_ca[pm10_ca$County %in% common_counties, ]
asthma_2015_2016<- asthma_2015_2016[asthma_2015_2016$COUNTY %in% common_counties, ]

```

Looking at observations per county: 
```{r}
# Count the number of observations per county for each dataset
pm25_county_obs <- table(pm25_ca$County)
ozone_county_obs <- table(ozone_ca$County)
pm10_county_obs <- table(pm10_ca$County)

# Convert the counts to data frames for easier plotting
pm25_df <- data.frame(County = names(pm25_county_obs), Observations = as.integer(pm25_county_obs))
ozone_df <- data.frame(County = names(ozone_county_obs), Observations = as.integer(ozone_county_obs))
pm10_df <- data.frame(County = names(pm10_county_obs), Observations = as.integer(pm10_county_obs))

# Plot the distribution of observations for PM2.5
ggplot(pm25_df, aes(x = County, y = Observations)) +
  geom_bar(stat = "identity", fill = "blue", color = "black", alpha = 0.7) +
  labs(title = "PM2.5 Observations per County", y = "Number of Observations") +
  theme_minimal() +
  theme(axis.text.x = element_blank(),  # Hide x-axis labels
        axis.title.x = element_blank())  # Hide x-axis title

# Plot the distribution of observations for Ozone
ggplot(ozone_df, aes(x = County, y = Observations)) +
  geom_bar(stat = "identity", fill = "green", color = "black", alpha = 0.7) +
  labs(title = "Ozone Observations per County", y = "Number of Observations") +
  theme_minimal() +
  theme(axis.text.x = element_blank(),  # Hide x-axis labels
        axis.title.x = element_blank())  # Hide x-axis title

# Plot the distribution of observations for PM10
ggplot(pm10_df, aes(x = County, y = Observations)) +
  geom_bar(stat = "identity", fill = "red", color = "black", alpha = 0.7) +
  labs(title = "PM10 Observations per County", y = "Number of Observations") +
  theme_minimal() +
  theme(axis.text.x = element_blank(),  # Hide x-axis labels
        axis.title.x = element_blank())  # Hide x-axis title

```

Filtering by season
```{r}
# Alter date column from 'chr' to 'date' for all pollutant
## PM10
pm10_ca$Date <- as.Date(pm10_ca$Date, format = "%m/%d/%Y")

##PM2.5
pm25_ca$Date <- as.Date(pm25_ca$Date, format = "%m/%d/%Y")

## Ozone
ozone_ca$Date <- as.Date(ozone_ca$Date, format = "%m/%d/%Y")

## SO2
so2_ca$Date <- as.Date(so2_ca$Date, format = "%m/%d/%Y")

## NO2
no2_ca$Date <- as.Date(no2_ca$Date, format = "%m/%d/%Y")


# Wet season: Oct - April
## Filter by dates
pm10_ca_wet <- pm10_ca %>%
  filter(month(Date) %in% c(1, 2, 3, 4, 10, 11, 12))
pm25_ca_wet <- pm25_ca %>%
  filter(month(Date) %in% c(1, 2, 3, 4, 10, 11, 12))
ozone_ca_wet <- ozone_ca %>%
  filter(month(Date) %in% c(1, 2, 3, 4, 10, 11, 12))
so2_ca_wet <- so2_ca %>%
  filter(month(Date) %in% c(1, 2, 3, 4, 10, 11, 12))
no2_ca_wet <- no2_ca %>%
  filter(month(Date) %in% c(1, 2, 3, 4, 10, 11, 12))

# Dry season: May - September
## Filter by dates
pm10_ca_dry <- pm10_ca %>%
  filter(month(Date) %in% c(5, 6, 7, 8, 9))
pm25_ca_dry <- pm25_ca %>%
  filter(month(Date) %in% c(5, 6, 7, 8, 9))
ozone_ca_dry <- ozone_ca %>%
  filter(month(Date) %in% c(5, 6, 7, 8, 9))
so2_ca_dry <-so2_ca %>%
  filter(month(Date) %in% c(5, 6, 7, 8, 9))
no2_ca_dry <- no2_ca %>%
  filter(month(Date) %in% c(5, 6, 7, 8, 9))
```

Looking at observations per county:
```{r}
# Count the number of observations per county for each dataset
pm10_county_obs_wet <- table(pm10_ca_wet$County)
pm10_county_obs_dry <- table(pm10_ca_dry$County)

pm25_county_obs_wet <- table(pm25_ca_wet$County)
pm25_county_obs_dry <- table(pm25_ca_dry$County)

ozone_county_obs_wet <- table(ozone_ca_wet$County)
ozone_county_obs_dry <- table(ozone_ca_dry$County)

so2_county_obs_wet <- table(so2_ca_wet$County)
so2_county_obs_dry <- table(so2_ca_dry$County)

no2_county_obs_wet <- table(no2_ca_wet$County)
no2_county_obs_dry <- table(no2_ca_dry$County)

# Convert the counts to data frames for easier plotting
pm10_df_wet <- data.frame(County = names(pm10_county_obs_wet), Observations = as.integer(pm10_county_obs_wet))
pm10_df_dry <- data.frame(County = names(pm10_county_obs_dry), Observations = as.integer(pm10_county_obs_dry))

pm25_df_wet <- data.frame(County = names(pm25_county_obs_wet), Observations = as.integer(pm25_county_obs_wet))
pm25_df_dry <- data.frame(County = names(pm25_county_obs_dry), Observations = as.integer(pm25_county_obs_dry))

ozone_df_wet <- data.frame(County = names(ozone_county_obs_wet), Observations = as.integer(ozone_county_obs_wet))
ozone_df_dry <- data.frame(County = names(ozone_county_obs_dry), Observations = as.integer(ozone_county_obs_dry))

so2_df_wet <- data.frame(County = names(so2_county_obs_wet), Observations = as.integer(so2_county_obs_wet))
so2_df_dry <- data.frame(County = names(so2_county_obs_dry), Observations = as.integer(so2_county_obs_dry))

no2_df_wet <- data.frame(County = names(no2_county_obs_wet), Observations = as.integer(no2_county_obs_wet))
no2_df_dry <- data.frame(County = names(no2_county_obs_dry), Observations = as.integer(no2_county_obs_dry))

```

Combine wet season pollutants into one dataframe
Combine dry seaosn pollutants into one dataframe
```{r}
# Add a column to each wet season dataframe to specify the pollutant type
pm10_df_wet <- pm10_df_wet %>% 
  mutate(Pollutant = "PM10")
pm25_df_wet <- pm25_df_wet %>%
  mutate(Pollutant = "PM2.5")
ozone_df_wet <- ozone_df_wet %>% 
  mutate(Pollutant = "Ozone")
no2_df_wet <- no2_df_wet %>% 
  mutate(Pollutant = "NO2")
so2_df_wet <- so2_df_wet %>% 
  mutate(Pollutant = "SO2")

# Add a column to each dry season dataframe to specify the pollutant type
pm10_df_dry <- pm10_df_dry %>%
  mutate(Pollutant = "PM10")
pm25_df_dry <- pm25_df_dry %>%
  mutate(Pollutant = "PM2.5")
ozone_df_dry <- ozone_df_dry %>% 
  mutate(Pollutant = "Ozone")
no2_df_dry <- no2_df_dry %>% 
  mutate(Pollutant = "NO2")
so2_df_dry <- so2_df_dry %>% 
  mutate(Pollutant = "SO2")

# Combine wet season dataframes into one
wet_season_data <- bind_rows(pm10_df_wet, pm25_df_wet, ozone_df_wet, no2_df_wet, so2_df_wet)

# Remove counties that do not have observations for all 4 pollutants
complete_counties <- wet_season_data %>%
  group_by(County) %>%
  summarise(Unique_Pollutants = n_distinct(Pollutant)) %>%
  filter(Unique_Pollutants == 5)

# Check valid counties
valid_counties <- complete_counties %>% 
  pull(County)

# Filter for only counties with all 4 pollutants
wet_season_data <- wet_season_data %>%
  filter(County %in% valid_counties)


# Combine dry season dataframes into one
dry_season_data <- bind_rows(pm10_df_dry,pm25_df_dry ,ozone_df_dry, no2_df_dry, so2_df_dry)

# Remove counties that do not have observations for all 4 pollutants
complete_counties2 <- dry_season_data %>%
  group_by(County) %>%
  summarise(Unique_Pollutants = n_distinct(Pollutant)) %>%
  filter(Unique_Pollutants == 4)

# Check valid counties
valid_counties2 <- complete_counties2 %>% 
  pull(County)

# Filter for only counties with all 4 pollutants
dry_season_data <- dry_season_data %>%
  filter(County %in% valid_counties2)
```

Figure 1
```{r}
# Distribution on PM10 across counties in the wet season (Jan-April, Oct-Dec)
#ggplot(pm10_df_wet, aes(x=County, y=Observations)) + geom_bar(stat = "identity", fill="lightblue", color = "black", alpha = 0.7) + labs(title = "PM10 Observations by County during the Wet Season", x="Counties", y = "Number of Observations") + theme_minimal()

# Create a combined bar chart
ggplot(wet_season_data, aes(x=County, y=Observations, fill=Pollutant)) +
  geom_bar(stat="identity", position="dodge", color="black") +
  labs(title=" 2022 Pollutant Observations by County during the Wet Season (Jan-April, Oct-Dec)",
       x="Counties",
       y="Number of Observations") +
  theme_minimal() +
  scale_fill_manual(values=c("PM10"="lightblue", "Ozone"="lightgreen", "NO2"="orange", "SO2"="purple", "PM2.5" = "pink")) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Figure 2
```{r}
ggplot(dry_season_data, aes(x=County, y=Observations, fill=Pollutant)) +
  geom_bar(stat="identity", position = "dodge", color="black") +
  labs(title="2022 Pollutant Observations by County during the Dry Season (May-Sept)",
       x="Counties", y="Number of Observations") +
  theme_minimal() +
  scale_fill_manual(values = c("PM10"="lightblue", "Ozone" = "lightgreen", "NO2"="orange", "SO2"="purple", "PM2.5" = "pink")) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

